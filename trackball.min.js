/*
Trackball.js v1.0.0 26/06/2021

Copyright (c) 2021, Robert Eisele (robert@xarg.org)
Licensed under the MIT license.
*/
(function(w){function h(c){function e(b){0!==g&&r();var t=n.getBoundingClientRect();m=k=performance.now();l=a.g(b.clientX,b.clientY,t);a.drag={startVector:l,box:t};requestAnimationFrame(a.loop)}function d(b){null!==a.drag&&(m=k,k=performance.now(),l=a.g(b.clientX,b.clientY,a.drag.box),b=Quaternion.fromBetweenVectors(a.drag.startVector,l),a.q=a.p.mul(b),requestAnimationFrame(a.loop))}function f(b){null!==a.drag&&(m=k,k=performance.now(),l=a.g(b.clientX,b.clientY,a.drag.box),b=Quaternion.fromBetweenVectors(a.drag.startVector,
l),a.p=a.q=a.p.mul(b),a.drag=null,g=Math.min(.2,Math.abs(2*Math.acos(b.w)/Math.max(k-m,1))),a.opts.smooth&&0<g?(u=[b.x,b.y,b.z],p=0,a.slideID=requestAnimationFrame(v)):requestAnimationFrame(a.loop))}function v(){p+=g;g*=.93;a.q=a.p.mul(Quaternion.fromAxisAngle(u,p));a.loop();.001>g?r():a.slideID=requestAnimationFrame(v)}function r(){cancelAnimationFrame(a.slideID);a.p=a.q;a.slideID=null;g=0}var a=this,l=null,m=0,k=0,g=0,u=null,p=0,q=a.events=[];c||(c={});c.nodeType&&(c={scene:c});"string"===typeof c.scene&&
(c.scene=document.querySelector(c.scene));a.opts=c;a.p=a.q=c.q||Quaternion.ONE;var n=c.scene;a.loop=function(){for(var b=0;b<q.length;b++)"draw"===q[b].type&&q[b].cb.call(a,a.q)};n.addEventListener("mousedown",e,{passive:!0});document.addEventListener("mousemove",d,{passive:!0});document.addEventListener("mouseup",f,{passive:!0});n.addEventListener("touchstart",function(b){b.preventDefault();1===b.touches.length&&e(b.touches[0])},{passive:!1});document.addEventListener("touchmove",function(b){1===
b.changedTouches.length&&d(b.changedTouches[0])},{passive:!0});document.addEventListener("touchend",function(b){1===b.changedTouches.length&&f(b.changedTouches[0])},{passive:!0});requestAnimationFrame(a.loop)}h.prototype={events:null,p:null,q:null,opts:null,slideID:null,drag:null,on:function(c,e){this.events.push({type:c,cb:e})},off:function(c,e){for(var d=this.events,f=d.length-1;0<=f;f--)d[f].type===c&&d[f].cb===e&&d.splice(f,1)},g:function(c,e,d){var f=Math.min(d.width,d.height)-1;c=(2*(c-d.x)-
d.width-1)/f;e=(2*(e-d.y)-d.height-1)/f;"x"===this.opts.limitAxis&&(e=0);"y"===this.opts.limitAxis&&(c=0);d=c*c+e*e;return[-c,-e,.5>=d?Math.sqrt(1-d):.5/Math.sqrt(d)]},rotate:function(c){this.drag||this.slideID||(this.q=this.p=this.p.mul(c),requestAnimationFrame(this.loop))}};"function"===typeof define&&define.amd?define([],function(){return h}):"object"===typeof exports?(Object.defineProperty(exports,"__esModule",{value:!0}),Quaternion["default"]=h,Quaternion.Trackball=h,module.exports=h):w.Trackball=h})(this);